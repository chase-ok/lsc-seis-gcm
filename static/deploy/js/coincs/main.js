!function(){require.config({paths:{jquery:"//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min","jquery-ui":"//ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min",datatables:"//ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.4/jquery.dataTables.min",d3:"//cdnjs.cloudflare.com/ajax/libs/d3/3.2.2/d3.v3"},shim:{d3:{exports:"d3"}}})}.call(this),function(){define("utils",["d3"],function(t){var n,i,e;return n=function(){function t(t,n){this._func=t,this._period=null!=n?n:1e3,this._id=null,this._running=!1}return t.prototype.func=function(t){return null!=t?(this._func=t,this.running()&&this.reset(),this):this._func},t.prototype.period=function(t){return null!=t?(this._period=t,this.running()&&this.reset(),this):this._period},t.prototype.running=function(t){return null!=t?(this._running=t,null!=this._id&&(clearInterval(this._id),this._id=null),t&&(this._id=setInterval(this.func(),this.period())),this):this._running},t.prototype.reset=function(){return this.running(!1),this.running(!0)},t}(),{definitions:window.definitions,describe:function(t,n){var i,e;for(i in n)e=n[i],t=t.attr(i,e);return t},mergeObj:function(t,n){var i,e;null==t&&(t={});for(i in n)e=n[i],null!=e&&(t[i]=e);return t},isEmpty:function(t){var n,i;for(n in t)if(i=t[n],t.hasOwnProperty(n))return!1;return!0},mash:function(t){var n,i,e,r;for(n={},e=0,r=t.length;r>e;e++)i=t[e],n[i[0]]=i[1];return n},loadJSON:i=function(n,e,r){return null==r&&(r=3),r>0?t.json(definitions.webRoot+n,function(t,s){return null==t&&s.success?e(s.data):(null!=t&&console.log(t),null!=s&&console.log(s.error),setTimeout(function(){return i(n,e,r-1)},10))}):void 0},loadUnwrappedJSON:e=function(n,i,r){return null==r&&(r=3),r>0?t.json(definitions.webRoot+n,function(t,s){return null!=t?(null!=t&&console.log(t),setTimeout(function(){return e(n,i,r-1)},10)):i(s)}):void 0},property:function(t){var n,i,e;return i=void 0,n="function"==typeof t||null==t.get?function(t){return t}:t.get,e="function"==typeof t?t:null!=t.set?t.set:function(){throw new Error("property is read-only")},function(t){return null!=t?(i=e.call(this,t,i),this):n.call(this,i)}},degrees:function(t){return 180*(t/Math.PI)},radians:function(t){return Math.PI/180*t},IntervalFunc:n}})}.call(this),function(){var t={}.hasOwnProperty,n=function(n,i){function e(){this.constructor=n}for(var r in i)t.call(i,r)&&(n[r]=i[r]);return e.prototype=i.prototype,n.prototype=new e,n.__super__=i.prototype,n},i=[].indexOf||function(t){for(var n=0,i=this.length;i>n;n++)if(n in this&&this[n]===t)return n;return-1};define("plots",["utils","d3","jquery"],function(t,e){var r,s,o,a,l,u,h,c,p,f,d;return c=t.mash,h=t.describe,p=t.mergeObj,f=t.property,d=0,u={top:40,right:70,bottom:50,left:60},a=function(){function t(t,n,i){var r;this.rootSelector=null!=t?t:"body",this.margin=null!=n?n:u,this.dimensions=null!=i?i:["x","y"],this.root=e.select(this.rootSelector),this.size={x:this.root.attr("width"),y:this.root.attr("height")},this.canvasSize={x:this.size.x-this.margin.left-this.margin.right,y:this.size.y-this.margin.top-this.margin.bottom},this._scales=c(function(){var t,n,i,s;for(i=this.dimensions,s=[],t=0,n=i.length;n>t;t++)r=i[t],s.push([r,e.scale.linear()]);return s}.call(this)),this._title="",this._prepared=!1}return t.prototype.select=function(t){return e.select(""+this.rootSelector+" "+t)},t.prototype.scales=function(t,n){var i,e;if(null==n&&(n={x:[0,this.canvasSize.x],y:[this.canvasSize.y,0]}),null!=t)return p(this._scales,t),this.declareDirty(),this;for(i in n)e=n[i],this._scales[i].range(e);return this._scales},t.prototype.title=function(t){return null!=t?(this._title=t,this._prepared&&this.select(".title").text(t),this):this._title},t.prototype.limits=function(t){var n,i;if(null!=t){for(n in t)i=t[n],this._scales[n].domain(i);return this.declareDirty(),this}return c(function(){var t,i,e,r;for(e=this.dimensions,r=[],t=0,i=e.length;i>t;t++)n=e[t],r.push([n,this._scales[n].domain()]);return r}.call(this))},t.prototype.maps=function(){var t;return c(function(){var n,i,e,r;for(e=this.dimensions,r=[],n=0,i=e.length;i>n;n++)t=e[n],r.push([t,this._scales[t].copy()]);return r}.call(this))},t.prototype.clear=function(){return this._prepared?(this.canvas.remove(),this._prepared=!1,this.prepare()):void 0},t.prototype.prepare=function(){return this._prepared?!1:(this._prepareCanvas(),this._prepareCanvasClipPath(),this._prepareTitle(),this._prepared=!0)},t.prototype.declareDirty=function(){return this.clear(),this.prepare(),this},t.prototype._prepareCanvas=function(){return this.canvas=h(this.root.append("g"),{"class":"canvas",transform:"translate("+this.margin.left+", "+this.margin.top+")"}),this.svgDefs=this.canvas.append("defs")},t.prototype._prepareCanvasClipPath=function(){return this.canvasClipId="canvas-clip-"+(d+=1),this._canvasClip=this.canvas.append("clipPath").attr("id",this.canvasClipId),h(this._canvasClip.append("rect"),{x:0,y:0,width:this.canvasSize.x,height:this.canvasSize.y})},t.prototype._prepareTitle=function(){var t;return t=20,h(this.canvas.append("text").text(this._title),{x:this.canvasSize.x/2,y:-this.margin.top+1.1*t,"text-anchor":"middle","font-size":""+t,"class":"title axis-label"})},t}(),r=function(t){function i(t,n){var e;null==t&&(t="body"),null==n&&(n=["x","y"]),i.__super__.constructor.call(this,t,null,n),this._axisLabels=c(function(){var t,n,i,r;for(i=this.dimensions,r=[],t=0,n=i.length;n>t;t++)e=i[t],r.push([e,e]);return r}.call(this)),this._ticks=c(function(){var t,n,i,r;for(i=this.dimensions,r=[],t=0,n=i.length;n>t;t++)e=i[t],r.push([e,null]);return r}.call(this)),this._showGrid=!0}return n(i,t),i.prototype.select=function(t){return e.select(""+this.rootSelector+" "+t)},i.prototype.axisLabels=function(t){var n,i,e;if(null!=t){if(p(this._axisLabels,t),this._prepared){e=this._axisLabels;for(n in e)i=e[n],this.select("."+n+".axis-label").text(i)}return this}return this._axisLabels},i.prototype.ticks=function(t){return null!=t?(p(this._ticks,t),this.declareDirty(),this):this._ticks},i.prototype.showGrid=function(t){return null!=t?(this._showGrid=t,this.declareDirty(),this):this._showGrid},i.prototype.prepare=function(){return i.__super__.prepare.call(this)?(this._prepareGrid(),this._prepareAxes(),this._prepareAxisLabels()):void 0},i.prototype._prepareGrid=function(){var t;if(this._showGrid)return t=this._makeAxes(),t.x.tickSize(-this.canvasSize.y,0,0).tickFormat(""),t.y.tickSize(-this.canvasSize.x,0,0).tickFormat(""),h(this.canvas.append("g"),{"class":"x grid",transform:"translate(0, "+this.canvasSize.y+")"}).call(t.x),h(this.canvas.append("g"),{"class":"y grid"}).call(t.y)},i.prototype._prepareAxisLabels=function(){var t,n;return t=15,h(this.canvas.append("text").text(this._axisLabels.x),{x:this.canvasSize.x/2,y:this.canvasSize.y+this.margin.bottom-1.1*t,"text-anchor":"middle","font-size":""+t,"class":"x axis-label"}),n=this.canvas.append("g").attr("transform","rotate(-90)"),h(n.append("text").text(this._axisLabels.y),{x:-this.canvasSize.y/2,y:1.1*t-this.margin.left,"text-anchor":"middle","font-size":""+t,"class":"y axis-label"})},i.prototype._prepareAxes=function(){var t;return t=this._makeAxes(),h(this.canvas.append("g"),{"class":"x axis",transform:"translate(0, "+this.canvasSize.y+")"}).call(t.x),h(this.canvas.append("g"),{"class":"y axis"}).call(t.y)},i.prototype._makeAxes=function(t){var n,i,r,s,o,a,l;for(null==t&&(t={x:"bottom",y:"left"}),n={},s=this.scales(),l=this.dimensions,o=0,a=l.length;a>o;o++)r=l[o],i=e.svg.axis().scale(s[r]).orient(t[r]),null!=this._ticks[r]&&i.ticks.apply(i,this._ticks[r]),n[r]=i;return n},i}(a),l=function(t){function i(t,n){null==n&&(n=["x","y","z"]),i.__super__.constructor.call(this,t,n),this._zBarWidth=30,this.canvasSize.x-=this._zBarWidth,this._zColor={lower:e.rgb(0,0,0),upper:e.rgb(255,0,0)}}return n(i,t),i.prototype.zColor=function(t){return null!=t?(p(this._zColor(t)),this.declareDirty(),this):this._zColor},i.prototype.scales=function(t,n){var e,r;if(null==n&&(n={z:[this.canvasSize.y,0]}),null!=t)return i.__super__.scales.call(this,t);t=i.__super__.scales.call(this);for(e in n)r=n[e],t[e].range(r);return t},i.prototype.maps=function(){var t,n,r,s;return r=i.__super__.maps.call(this),n=this.canvasSize.y,s=this.zColor(),t=e.interpolateRgb(s.lower,s.upper),{x:r.x,y:r.y,z:function(i){return t(1-r.z(i)/n)}}},i.prototype.prepare=function(){return i.__super__.prepare.call(this)?(this._prepareZGradient(),this._prepareZColorBar(),this._prepareZAxis(),this._prepareZLabel()):void 0},i.prototype._prepareZGradient=function(){var t;return t=this.zColor(),this._zGradient=h(this.svgDefs.append("linearGradient"),{id:"zGradient",x1:"0%",y1:"100%",x2:"0%",y2:"0%"}),h(this._zGradient.append("stop"),{offset:"0%","stop-color":t.lower,"stop-opacity":1}),h(this._zGradient.append("stop"),{offset:"100%","stop-color":t.upper,"stop-opacity":1})},i.prototype._prepareZColorBar=function(){var t;return t=10,this._zColorBar=h(this.canvas.append("rect"),{x:this.canvasSize.x+t,y:0,width:this._zBarWidth-t,height:this.canvasSize.y,fill:"url(#"+this._zGradient.attr("id")+")"})},i.prototype._prepareZAxis=function(){return h(this.canvas.append("g"),{"class":"z axis",transform:"translate("+(this.canvasSize.x+this._zBarWidth)+", 0)"}).call(this._makeAxes({z:"right"}).z)},i.prototype._prepareZLabel=function(){var t,n;return t=15,n=this.canvas.append("g").attr("transform","rotate(-90)"),h(n.append("text").text(this.axisLabels().z),{x:-this.canvasSize.y/2,y:this.canvasSize.x+this._zBarWidth+this.margin.right,"text-anchor":"middle","font-size":""+t,"class":"z axis-label"})},i}(r),s=function(t){function i(t){i.__super__.constructor.call(this,t),this.bins([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]),this.useProbability(!0),this.limits({y:[0,1]})}return n(i,t),i.prototype.bins=function(t){return null!=t?(this._bins=t,this.declareDirty(),this):this._bins},i.prototype.useProbability=function(t){return null!=t?(this._useProbability=t,this.axisLabels({y:t?"Probability":"Frequency"}),this.declareDirty(),this):this._useProbability},i.prototype.plot=function(t){var n,i,r,s,o,a;return this.prepare(),a=this.scales(),s=a.x,o=a.y,i=e.layout.histogram(),null!=this.bins()&&i.bins(this.bins()),i.frequency(!this.useProbability()),n=i(t),this.canvas=e.select(this.rootSelector+">.canvas"),r=this.canvas.selectAll("rect.histogram-bar").data(n),h(r.enter().append("rect"),{"class":"histogram-bar",x:function(t){return Math.floor(s(t.x))},y:function(t){return o(t.y)},width:function(t){return Math.ceil(s(t.x+t.dx)-s(t.x))},height:function(t){return o(0)-o(t.y)},fill:"steelblue","shape-rendering":"crispEdge"}),r.exit().remove()},i}(r),o=function(t){function r(t,n){null==t&&(t="body"),null==n&&(n=["x","y","color","size"]),r.__super__.constructor.call(this,t,n),this.showLegend(!1),this.scales({color:e.scale.category20(),size:e.scale.ordinal()}),this.groups(["default"])}return n(r,t),r.prototype.showLegend=f(function(t){return this.declareDirty(),t}),r.prototype.groups=f(function(t){var n;return this.scales().color.domain(t),this.scales().size.domain(t).range(function(){var i,e,r;for(r=[],i=0,e=t.length;e>i;i++)n=t[i],r.push(5);return r}()),this.declareDirty(),t}),r.prototype.sizes=f({get:function(){var t,n,i;return i=this.scales().size.range(),t=this.groups(),c(function(){var e,r,s;for(s=[],n=e=0,r=t.length;r>=0?r>e:e>r;n=r>=0?++e:--e)s.push([t[n],i[n]]);return s}())},set:function(t){var n,i,e,r,s,o;for(e=this.scales().size.range(),n=this.groups(),i=s=0,o=n.length;o>=0?o>s:s>o;i=o>=0?++s:--s)r=t[n[i]],null!=r&&(e[i]=r);return this.scales().size.range(e),this.declareDirty()}}),r.prototype.colors=f({get:function(){var t,n,i;return i=this.scales().color.range(),t=this.groups(),c(function(){var e,r,s;for(s=[],n=e=0,r=t.length;r>=0?r>e:e>r;n=r>=0?++e:--e)s.push([t[n],i[n]]);return s}())},set:function(t){var n,i,e,r,s,o;for(r=this.scales().color.range(),i=this.groups(),e=s=0,o=i.length;o>=0?o>s:s>o;e=o>=0?++s:--s)n=t[i[e]],null!=n&&(r[e]=n);return this.scales().color.range(r),this.declareDirty()}}),r.prototype.prepare=function(){return r.__super__.prepare.call(this)?this._prepareLegend():void 0},r.prototype._prepareLegend=function(){var t,n,i,r,s,o,a=this;if(this.showLegend())return s=5,r={x:100,y:20},n=this.groups(),i=h(this.canvas.append("g").selectAll(".legend").data(e.zip(function(){o=[];for(var t=0,i=n.length;i>=0?i>t:t>i;i>=0?t++:t--)o.push(t);return o}.apply(this),n)).enter().append("g"),{"class":"legend",transform:function(t){return"translate("+(a.canvasSize.x-r.x)+", "+t[0]*(r.y+s)+")"}}),t=this.scales().color,h(i.append("rect"),{x:0,y:0,width:r.x,height:r.y,stroke:"none",fill:function(n){return t(n[1])}}),h(i.append("text").text(function(t){return t[1]}),{x:3,y:r.y-5,"text-anchor":"start","font-size":""+(r.y-8),"font-weight":"bold",fill:"white"})},r.prototype.plot=function(t){var n,r,s,o,a,l,u,c,p,f,d,_,y,g,v;for(this.prepare(),o=[],y=this.groups(),p=0,d=y.length;d>p;p++)if(s=y[p],!(i.call(t,s)<0))for(g=t[s],f=0,_=g.length;_>f;f++)a=g[f],o.push({group:s,point:a});return v=this.scales(),u=v.x,c=v.y,r=v.color,l=v.size,this.canvas=e.select(this.rootSelector+">.canvas"),n=this.canvas.selectAll("circle.scatter-point").data(o),h(n.enter().append("circle"),{"class":"scatter-point","clip-path":"url(#"+this.canvasClipId+")"}),h(n.transition().duration(500),{cx:function(t){return u(t.point[0])},cy:function(t){return c(t.point[1])},r:function(t){return l(t.group)},stroke:"none",fill:function(t){return r(t.group)}}),n.exit().remove()},r}(r),{SvgPlot:a,BasicPlot:r,ZColorPlot:l,Histogram:s,ScatterPlot:o}})}.call(this),function(){var t={}.hasOwnProperty,n=function(n,i){function e(){this.constructor=n}for(var r in i)t.call(i,r)&&(n[r]=i[r]);return e.prototype=i.prototype,n.prototype=new e,n.__super__=i.prototype,n},i=[].indexOf||function(t){for(var n=0,i=this.length;i>n;n++)if(n in this&&this[n]===t)return n;return-1};define("coincs/hive",["utils","plots","d3","jquery"],function(t,e,r){var s,o,a,l,u;return o=t.definitions,a=t.describe,l=t.loadJSON,u=t.radians,s=function(t){function s(t,n){var i,e,o,a,l;this.group=n,a={left:10,top:30,right:10,bottom:10},e=["time","snr","snrRatio","channelColor","chainPosition","channelPosition"],s.__super__.constructor.call(this,t,a,e),this._loaded=!1,this._drawing=!1,this._channels=this.group.channels,this._channelIds=function(){var t,n,e,r;for(e=this._channels,r=[],t=0,n=e.length;n>t;t++)i=e[t],r.push(i.id);return r}.call(this),this._numChannels=this._channels.length,this._infoSize={x:350,y:this.canvasSize.y},this._plotSize={x:this.canvasSize.x-this._infoSize.x-15,y:this.canvasSize.y},this._barSpacing={x:this._plotSize.x/(this._numChannels-1),y:5},this._barSize={x:10,y:this.canvasSize.y/this._numChannels-this._barSpacing.y},this.snrBaseThreshold(0),this.snrRange([0,1/0]),this.snrRatioColors({good:r.rgb(0,255,0),neutral:r.rgb(100,100,100),bad:r.rgb(255,0,0)}),this.scales({time:r.scale.linear().range([0,this._barSize.y]).clamp(!0),snr:r.scale.log().range([1,6]),snrRatio:r.scale.linear().domain([.5,1.5]).range([-1,1]).clamp(!0),channelColor:r.scale.category20().domain(this._channelIds),chainPosition:r.scale.ordinal().domain(function(){l=[];for(var t=0,n=this._numChannels;n>=0?n>t:t>n;n>=0?t++:t--)l.push(t);return l}.apply(this)).range(function(){var t,n,i;for(i=[],o=t=0,n=this._numChannels;n>=0?n>t:t>n;o=n>=0?++t:--t)i.push(this._barSpacing.x*o);return i}.call(this)),channelPosition:r.scale.ordinal().domain(this._channelIds).range(function(){var t,n,i;for(i=[],o=t=0,n=this._numChannels;n>=0?n>t:t>n;o=n>=0?++t:--t)i.push(o*(this._barSpacing.y+this._barSize.y));return i}.call(this))})}return n(s,t),s.prototype.snrBaseThreshold=function(t){return null!=t?(this._snrBaseThreshold=t,this.declareDirty(),this):this._snrBaseThreshold},s.prototype.snrRange=function(t){var n,i;return null!=t?(this._snrRange=t,null!=this.coincs&&(i=t[0],n=t[1],a(this.canvas.selectAll("path.link"),{display:function(t){var e;return i<=(e=t.snr)&&n>=e?"true":"none"}})),this):this._snrRange},s.prototype.snrRatioColors=function(t){return null!=t?(this._snrRatioColors=t,this.declareDirty(),this):this._snrRatioColors},s.prototype.load=function(){var t,n=this;return t="/coinc/group/"+this.group.id+"/all",l(t,function(t){return n.coincs=t.coincs,n._loaded=!0,n._draw()})},s.prototype.declareDirty=function(){return s.__super__.declareDirty.call(this),this._loaded&&!this._drawing?this._draw():void 0},s.prototype._getSnrRatioMap=function(){var t,n,i,e,s,o,a;return o=this.maps().snrRatio,a=this.snrRatioColors(),i=a.good,s=a.neutral,t=a.bad,e=r.interpolateRgb(s,i),n=r.interpolateRgb(s,t),function(t){var i;return i=o(t),i>0?n(i):e(-i)}},s.prototype.prepare=function(){return s.__super__.prepare.call(this)?(this._prepareInfo(),this._prepareLegend(),this._prepareSnrHistogram(),this._prepareLinkInfo()):void 0},s.prototype._prepareInfo=function(){return this._info=a(this.canvas.append("g"),{transform:"translate("+(this.canvasSize.x-this._infoSize.x)+", 0)"}),this._currentInfoY=0},s.prototype._prepareLegend=function(){var t,n,e,s,o,l=this;return s=5,e={x:this._infoSize.x,y:20},n=a(this._info.append("g").selectAll(".legend").data(r.zip(function(){o=[];for(var t=0,n=this._numChannels;n>=0?n>t:t>n;n>=0?t++:t--)o.push(t);return o}.apply(this),this._channels)).enter().append("g"),{"class":"legend",transform:function(t){return"translate(0, "+(l._currentInfoY+t[0]*(e.y+s))+")"}}),t=this.maps().channelColor,a(n.append("rect"),{x:0,y:0,width:e.x,height:e.y,stroke:"none",fill:function(n){return t(n[1].id)}}),a(n.append("text").text(function(t){return t[1].subsystem+":"+t[1].name}),{x:3,y:e.y-5,"text-anchor":"start","font-size":""+(e.y-8),"font-weight":"bold",fill:"white"}),n.on("mouseover",this._mouseOver(function(t,n){var e;return e=t[1].id,i.call(l.coincs[n.coincId].channel_ids,e)>=0})),n.on("mouseout",this._mouseOut()),this._currentInfoY+=this._numChannels*(e.y+s)+10},s.prototype._prepareSnrHistogram=function(){var t,n,i,s,o,l,u,h=this;return n=250,t=a(this._info.append("g"),{"class":"snr-histogram",transform:"translate(0, "+this._currentInfoY+")",height:n,width:this._infoSize.x}),this._snrHistogram=new e.Histogram("g.snr-histogram"),this._snrHistogram.bins(function(){u=[];for(var t=o=0|this.snrBaseThreshold;25>=o?25>=t:t>=25;25>=o?t++:t--)u.push(t);return u}.apply(this)),this._snrHistogram.limits({x:[this.snrBaseThreshold(),25],y:[0,.5]}),this._snrHistogram.axisLabels({x:"Max SNR"}),this._snrBrush=r.svg.brush(),this._snrBrush.x(this._snrHistogram.scales().x),this._snrBrush.y(this._snrHistogram.scales().y),this._snrBrush.clamp([!0,!0]),l=this._snrHistogram.limits().y,i=l[0],s=l[1],this._snrBrush.on("brush",function(){var t,n,e,r,o,a;return r=h._snrBrush.extent(),o=r[0],t=o[0],e=o[1],a=r[1],n=a[0],e=a[1],h._snrBrush.extent([[t,i],[n,s]]),h._snrBrush(h._snrHistogram.canvas)}),this._snrBrush.on("brushend",function(){var t,n,i,e,r,s;return e=h._snrBrush.extent(),r=e[0],t=r[0],i=r[1],s=e[1],n=s[0],i=s[1],Math.abs(n-h._snrHistogram.limits().x[1])<1&&(n=1/0),h.snrRange([t,n])}),this._currentInfoY+=n},s.prototype._prepareLinkInfo=function(){var t,n,i,e;return t=250,i=a(this._info.append("g"),{transform:"translate(0, "+this._currentInfoY+")",width:this._infoSize.x,height:t}),e=12,n=5,this._writeInfo=function(t){var r;return r=i.selectAll("text").data(t),a(r.enter().append("text"),{x:3,y:function(t,i){return(i+1)*e+i*n},"text-anchor":"start","font-size":e,"font-weight":"bold"}),r.text(function(t){return t}),r.exit().remove()},this._currentInfoY+=t+10},s.prototype._draw=function(){var t,n,i,e,s,o,a;for(this._drawing=!0,e=this.snrBaseThreshold(),s=this.coincs,this.coincs=[],i=[],o=0,a=s.length;a>o;o++)t=s[o],n=Math.max.apply(Math,t.snrs),n>=e&&(this.coincs.push(t),i.push(n));return this.limits({time:[this.coincs[0].times[0],Math.max.apply(Math,this.coincs[this.coincs.length-1].times)],snr:r.extent(i)}),this.prepare(),this._drawLinks(),this._drawBars(),this._snrHistogram.plot(i),this._snrBrush(this._snrHistogram.canvas),this._drawing=!1},s.prototype._drawBars=function(){var t,n,i,e,r,s,o,l,u,h,c,p,f,d=this;for(c=this.maps(),e=c.channelColor,n=c.chainPosition,r=c.channelPosition,s=[],o=l=0,p=this._numChannels;p>=0?p>l:l>p;o=p>=0?++l:--l)for(f=this._channels,u=0,h=f.length;h>u;u++)i=f[u],s.push([o,i]);return t=a(this.canvas.selectAll("rect.hive-bar").data(s).enter().append("rect"),{"class":"hive-bar",x:function(t){return n(t[0])-d._barSize.x/2},y:function(t){return r(t[1].id)},width:this._barSize.x,height:this._barSize.y,stroke:"none",fill:function(t){return e(t[1].id)}}),t.on("mouseover",this._mouseOver(function(t,n){return d.coincs[n.coincId].channel_ids[t[0]]===t[1].id})),t.on("mouseout",this._mouseOut())},s.prototype._drawLinks=function(){var t,n,i,e,s,o,l,u,h,c,p,f,d,_,y,g,v,m,x,b=this;for(l=a(this.canvas.append("g")),u=[],s=y=0,v=this.coincs.length;v>=0?v>y:y>v;s=v>=0?++y:--y)for(e=this.coincs[s],p=g=0,m=e.length-1;m>=0?m>g:g>m;p=m>=0?++g:--g)u.push({coincId:s,chainPosition:p,time:e.times[p],dt:e.times[p+1]-e.times[p],snr:e.snrs[0],freq:e.freqs[p],snrRatio:e.snrs[p+1]/e.snrs[p],startChannelId:e.channel_ids[p],endChannelId:e.channel_ids[p+1]});return x=this.maps(),_=x.time,f=x.snr,n=x.channelColor,t=x.chainPosition,i=x.channelPosition,d=this._getSnrRatioMap(),o=r.svg.diagonal().projection(function(t){return[t.y,t.x]}),c=a(l.selectAll("path.link").data(u).enter().append("path"),{"class":"link",fill:"none",stroke:function(t){return d(t.snrRatio)},"stroke-width":function(t){return f(t.snr)},"stroke-opacity":.5,"stroke-dasharray":function(t){return t.dt>1e-5?"15, 3":"none"},d:function(n){return o({source:{y:t(n.chainPosition),x:i(n.startChannelId)+_(n.time)},target:{y:t(n.chainPosition+1),x:i(n.endChannelId)+_(n.time)}})}}),h=this._mouseOver(function(t,n){return t.coincId===n.coincId}),c.on("mouseover",function(t){var n,i,s,o;return o=function(t,n){var i;return i=new Date(1e3*t),r.time.format.utc(n)(i)},i=function(t){return r.format(".1f")(t)},n=function(t){return r.format(".3f")(t)},e=b.coincs[t.coincId],b._writeInfo(["Time: "+o(t.time,"%Y-%m-%d %H:%M:%S.%L"),"SNR: "+i(t.snr),"Frequency: "+n(t.freq),"","All Times: "+function(){var t,n,i,r;for(i=e.times,r=[],t=0,n=i.length;n>t;t++)s=i[t],r.push(o(s,"%S.%L"));return r}(),"All SNRs: "+e.snrs.map(i),"All Frequencies: "+e.freqs.map(n)]),h(t)}),c.on("mouseout",function(){return b._writeInfo([]),b._mouseOut()()})},s.prototype._mouseOver=function(t){var n,i=this;return n=this.maps().snr,function(e){return a(i.canvas.selectAll("path.link"),{"stroke-opacity":function(n){return t(e,n)?1:.05},"stroke-width":function(i){var r;return r=n(i.snr),t(e,i)?2*r:r/2}})}},s.prototype._mouseOut=function(){var t,n=this;return t=this.maps().snr,function(){return a(n.canvas.selectAll("path.link"),{"stroke-opacity":.5,"stroke-width":function(n){return t(n.snr)}})}},s}(e.SvgPlot),{HivePlot:s}})}.call(this),function(){define("coincs/main",["utils","coincs/hive","jquery","jquery-ui"],function(t,n,i){var e;return console.log("Starting"),e=t.definitions.group,i(function(){var t;return t=new n.HivePlot("#hive",e),t.snrBaseThreshold(8),t.title(e.name),t.load()})})}.call(this);